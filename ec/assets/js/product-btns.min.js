document.addEventListener("DOMContentLoaded",function(){if(window.productCardsInitialized)return;window.productCardsInitialized=!0;let t=[];const e=document.getElementById("compareBar"),i=document.getElementById("compareCount"),n=document.getElementById("compareBtn"),o=document.getElementById("clearCompare");let s=0;fetch("wishlist-handler.php?action=count").then(t=>t.json()).then(t=>{t.success&&(s=t.count,r())}).catch(t=>{}),fetch("wishlist-handler.php?action=get").then(t=>t.json()).then(t=>{if(t.success){const e=t.wishlist;s=t.count,document.querySelectorAll(".product-add-to-wishlist").forEach(function(t){const i=t.closest(".product-item");if(i){const n=i.getAttribute("data-product-id");if(e.includes(n)){t.classList.add("active");const e=t.querySelector("svg");e&&(e.classList.add("wishlist-active"),e.classList.remove("wishlist-inactive"))}}}),r()}}).catch(t=>{});const c=document.querySelectorAll(".compare-btn");function a(){const o=t.length;i&&(i.textContent=o+" selected"),e&&o>0?(e.style.transform="translateY(0)",n&&(n.disabled=o<2)):e&&(e.style.transform="translateY(100%)",n&&(n.disabled=!0))}c.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();const i=this.getAttribute("data-product-id"),n=this.closest(".product-item"),o=n.getAttribute("data-product-title"),s=n.getAttribute("data-product-price"),c=n.getAttribute("data-product-image");if(this.classList.contains("active"))t=t.filter(function(t){return t.id!==i}),this.classList.remove("active");else{if(!(t.length<4))return void d("You can only compare up to 4 products at a time.","warning");t.push({id:i,title:o,price:s,image:c}),this.classList.add("active")}a()})}),n&&n.addEventListener("click",function(){if(t.length>=2){const e=t.map(function(t){return t.id}).join(",");window.location.href="compare.php?products="+e}}),o&&o.addEventListener("click",function(){t=[],c.forEach(function(t){t.classList.remove("active")}),a()});function l(t){document.body.style.overflow="auto",t.remove()}document.querySelectorAll(".quick-view-btn").forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();const e=this.closest(".product-item");!function(t,e,i,n){const o=document.querySelector(".quickViewModal");o&&o.remove();const s=document.createElement("div");s.className="quickViewModal animate-fade-in fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",s.innerHTML=`\n            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">\n                <div class="flex justify-between items-center p-4 border-b sticky top-0 bg-white dark:bg-gray-800">\n                    <h2 class="quickViewTitle text-xl font-semibold">${e}</h2>\n                    <button class="closeQuickView text-gray-400 hover:text-gray-600 text-3xl leading-none w-8 h-8 flex items-center justify-center" type="button">&times;</button>\n                </div>\n                <div class="quickViewContent p-6">\n                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">\n                        <div class="product-image">\n                            <img src="${n}" alt="${e}" class="w-full h-64 object-cover rounded-lg">\n                        </div>\n                        <div class="product-details">\n                            <h3 class="text-lg font-semibold mb-2">${e}</h3>\n                            <p class="text-2xl font-bold text-blue-600 mb-4">$${i}</p>\n                            <div class="space-y-4">\n                                <button class="w-full te-btn te-btn-primary" onclick="alert('Added to cart!')">\n                                    Add to Cart\n                                </button>\n                                <a href="single.php?id=${t}" class="w-full te-btn te-btn-default block text-center">\n                                    View Full Details\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,document.body.appendChild(s),document.body.style.overflow="hidden";s.querySelector(".closeQuickView").addEventListener("click",function(){l(s)}),s.addEventListener("click",function(t){t.target===s&&l(s)})}(e.getAttribute("data-product-id"),e.getAttribute("data-product-title"),e.getAttribute("data-product-price"),e.getAttribute("data-product-image"))})}),document.addEventListener("keydown",function(t){if("Escape"===t.key){document.querySelectorAll(".quickViewModal").forEach(function(t){l(t)})}});document.querySelectorAll(".product-item").forEach(function(t){const e=t.querySelectorAll(".size-option");e.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.forEach(function(t){t.classList.remove("active")}),this.classList.add("active")})});const i=t.querySelectorAll(".color-option");i.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),i.forEach(function(t){t.classList.remove("active")}),this.classList.add("active")})})});document.querySelectorAll(".product-add-to-cart").forEach(function(t){t.addEventListener("click",function(t){if(t.preventDefault(),t.stopPropagation(),this.hasAttribute("data-cart-initialized")||(this.querySelector(".icon-cart")||this.insertAdjacentHTML("afterbegin",'<svg class="w-5 h-5 icon-cart" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.6" strokeLinecap="round" strokeLinejoin="round">\n                    <path d="M2.048 18.566A2 2 0 0 0 4 21h16a2 2 0 0 0 1.952-2.434l-2-9A2 2 0 0 0 18 8H6a2 2 0 0 0-1.952 1.566z"></path>\n                    <path d="M8 11V6a4 4 0 0 1 8 0v5"></path>\n                </svg>'),this.querySelector(".icon-loading")||this.insertAdjacentHTML("afterbegin",'<svg class="w-5 h-5 icon-loading animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" style="display: none;">\n                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="2"></circle>\n                    <path class="opacity-100" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>\n                </svg>'),this.querySelector(".icon-added")||this.insertAdjacentHTML("afterbegin",'<svg class="w-5 h-5 icon-added" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style="display: none;">\n                    <path d="M20 6 9 17l-5-5"></path>\n                </svg>'),this.setAttribute("data-cart-initialized","true")),this.disabled||this.classList.contains("tewido-disabled"))return;const e=this.querySelector(".icon-cart"),i=this.querySelector(".icon-loading"),n=this.querySelector(".icon-added"),o=this.querySelector("span");if(!o)return;const s=o.textContent.trim()||"Add to cart";o.textContent="Adding...",e&&(e.style.display="none"),i&&(i.style.display="inline-block"),n&&(n.style.display="none"),this.classList.add("btn-clicked","tewido-disabled"),this.setAttribute("aria-disabled","true"),setTimeout(()=>{document.contains(this)&&(o.textContent="Added",i&&(i.style.display="none"),n&&(n.style.display="inline-block"),this.classList.add("product-added"))},800),setTimeout(()=>{document.contains(this)&&(o.textContent=s,n&&(n.style.display="none"),e&&(e.style.display="inline-block"),this.classList.remove("btn-clicked","tewido-disabled","product-added"),this.removeAttribute("aria-disabled"))},2e3),d("Product added to cart!","success")})});function r(){const t=document.querySelector(".wishlist-counter");t&&(t.textContent=s,t.style.display=s>0?"block":"none");const e=document.querySelector(".wishlist-badge");e&&(e.textContent=s,e.style.display=s>0?"inline-block":"none");document.querySelectorAll(".wishlist-link-text").forEach(function(t){t.textContent=`Wishlist (${s})`})}function d(t,e="info"){document.querySelectorAll(".toast-notification").forEach(t=>t.remove());const i=document.createElement("div");i.className="toast-notification fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transform transition-all duration-300 ease-in-out translate-x-full";const n={success:"bg-green-500 text-white",error:"bg-red-500 text-white",warning:"bg-yellow-500 text-black",info:"bg-blue-500 text-white"};i.className+=" "+(n[e]||n.info),i.innerHTML=`\n            <div class="flex items-center justify-between min-w-[200px]">\n                <span>${t}</span>\n                <button class="close-notification ml-3 text-lg font-bold opacity-70 hover:opacity-100" type="button">&times;</button>\n            </div>\n        `,document.body.appendChild(i),setTimeout(()=>{i.classList.remove("translate-x-full")},100);i.querySelector(".close-notification").addEventListener("click",function(){u(i)}),setTimeout(()=>{u(i)},3e3)}function u(t){t.classList.add("translate-x-full"),setTimeout(()=>{t.parentNode&&t.remove()},300)}document.querySelectorAll(".product-add-to-wishlist").forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();const e=this.closest(".product-item");if(e){const t=e.getAttribute("data-product-id");t&&function(t,e){fetch("wishlist-handler.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"toggle",product_id:t})}).then(t=>t.json()).then(t=>{if(t.success){s=t.count;const i=e.querySelector("svg");"added"===t.action?(e.classList.add("active"),i&&(i.classList.add("wishlist-active"),i.classList.remove("wishlist-inactive")),d("Added to wishlist!","success")):(e.classList.remove("active"),i&&(i.classList.add("wishlist-inactive"),i.classList.remove("wishlist-active")),d("Removed from wishlist!","info")),r()}else d("Error updating wishlist","error")}).catch(t=>{d("Error updating wishlist","error")})}(t,this)}})}),a()});